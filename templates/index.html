<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Mock Server</title>
</head>

<body>
    <!--Label for window-->
    <label id="labelForMockRequests">Generating Mock Requests</label><br>
    <!--Label for username followed by text label for entering username-->
    <label for="userName">Enter UserName: </label>
    <input type="text" id="userName"><br>
    <!--Label for password followed by text label for entering password. Password will be hidden by default-->
    <label for="password">Enter Password: </label>
    <input type="password" id="userPassword">
    <!--Checkbox to toggle the passwords visibility-->
    <input type="checkbox" onclick="showPassword()">Show Password
    <!--Button to authenticate the information entered-->
    <br><button onclick="authenticateInformation();">Authenticate</button>
    <!--Label displaying if the authentication was successful or not-->
    <label id="labelForAuthenicationSuccess"></label><br>
    <!--Div that will contain the table showing user information-->
    <div id="table-container"></div>
    <script>
        /** 
        * This function is creating a request to authenticate the information entered by the user. It will send the 
        * the username and password entered by the user to the backend and after verification the backend will return
        * the information associated with the user.
        * @summary 
        */
        function authenticateInformation() {

            // Getting the username and password entered by the user
            user_name = document.getElementById('userName').value;
            password = document.getElementById('userPassword').value;
            
            // Generating a request to authenticate the entered username and password
            let sendData = new XMLHttpRequest();

            // This function is performed when the status of the request generated changes. 
            sendData.onreadystatechange = function () {
                // If the request has been completed and the response is available (i.e. the value of this.readyState == 4)
                // and the request was successful (i.e. the value of this.status == 200), the function that will display the
                // output of the request is called and the response generated by the request is given as the argument of 
                // that function
                if (this.readyState === 4 && this.status === 200) {
                    // Obtaining the data parsed by the backend
                    isValid(JSON.parse(this.responseText));
                }
            };

            // opening a HTTP POST request at the get_authentication endpoint
            sendData.open("POST", '/get_authentication', true); // asynchronously send request to get the authentication from backend
            sendData.setRequestHeader('Content-Type', 'application/json'); // set the request header informing the data being sent as JSON

            // Create an object to hold the data
            const requestData = {
                "user_name": user_name,
                "password": password
            };

            // sending the data as JSON along with the HTTP request.
            sendData.send(JSON.stringify(requestData));
        }
        
        /** 
        * This function displays the output of the request i.e. it shows an error if incorrect username or password was entered or
        * it displays the users information
        * @param {JSON} validationState - This contains the information sent by the backend. If the username or password were incorrect
        * it contains only an error code in Authentication, otherwise it contains the users data as well.
        */
        function isValid(validationState) {
            // If correct information was entered 
            if (validationState.Authentication == 'Login successful.') {
                // This sets the label to display whether the username and password were correct
                document.getElementById('labelForAuthenicationSuccess').innerHTML = validationState.Authentication
                // This calls the function that creates the table containing the user data
                createTable(validationState.Data)
            }
            // If incorrect information was entered
            else {
                // We first clear the table containing any previous information
                element = document.getElementById("table-container")
                table = document.getElementById('myTable')
                if (table) { element.removeChild(table) }
                // Display the error highlighting which information was incorrect
                document.getElementById('labelForAuthenicationSuccess').innerHTML = validationState.Authentication

            }
        }

        /** 
        * This function is used to create the table to display the users information
        * @param {Dictionary} data - contains the user information in the form of a dictionary
        */
        function createTable(data) {
            // Get the container div where the table will be displayed
            var container = document.getElementById("table-container");

            // Create a table element and assign its ID. We will need the ID later when we want to delete it 
            var table = document.createElement("table");
            table.id = 'myTable'
            
            // Iterating through the dictionary keys
            for (var key in data) {
                // Checking if object has key value in it
                if (data.hasOwnProperty(key)) {
                    // Adding a new row to the table
                    var row = document.createElement("tr");
                    
                    // Adding two columns to the table to display the information
                    var cell1 = document.createElement("td");
                    var cell2 = document.createElement("td");

                    // Setting the values of both cells
                    cell1.textContent = key;
                    cell2.textContent = data[key];
                    
                    // Appending the cells to the row
                    row.appendChild(cell1);
                    row.appendChild(cell2);
                    
                    // Appending the row to the table
                    table.appendChild(row);
                }
            }

            // Append the table to the container
            container.appendChild(table);
        }

        /** 
        * This function is used to toggle the visibility of the password. It is called when the checkbox is toggled
        */
        function showPassword() {
            // Getting the label containing the password
            x = document.getElementById("userPassword");

            // If the password is hidden, unhide it and vice versa
            if (x.type === "password") {
                x.type = "text";
            } else {
                x.type = "password";
            }
        }

    </script>
</body>

</html>